# アフターアクションレビュー (AAR)

## 1. 何が起こるはずだったか？ (What was supposed to happen?)
- タイ政府のオープンデータポータルから提供されている土地局（DOL）の Parcel データから PMTiles を生産する作業を、Makefile ベースで実施することにより、一連の流れの可視化とブラッシュアップを行う。
  - 一連の流れとは、UNVT で提唱されている produce, host, style, optimize の流れを指す。
  - ogr2ogr で GeoJSONSeq を作り、jq を積極的に使って tippecanoe のための前処理を行う。
- 生産した PMTiles データを Source Cooperative でホストし、ついで、Martin でホストする。
- vite を使ってウェブサイトをホストする。Martin のリバースプロキシも vite で設定するようにする。
- 低いズームレベルについては、H3 の六角形が表示されるようにする。
  - H3 への変換については、まず adr_h3.md によってコンセプトをまとめる。adr とは Architectural Design Decision の略称である。
  - adr_h3.md には、H3 の導入目的、変換手順、使用するツール、及び期待される成果を記載する。
  - 具体的なタスクとして、H3 の変換スクリプトを作成し、テストデータで検証を行う。

## 2. 実際に何が起こったか？ (What actually happened?) 
- Source Cooperative が必ずしも安定しておらず、アクセスできない時間帯があった。
- PMTiles の生成は成功したが、ホスティング環境の不安定さが課題となった。
- ソースデータのジオメトリが壊れていたり、ソースデータの測地系がエベレスト1975測地系であったりして苦労した。
  - 測地系の変換は、シフトパラメータを明示的に設定することで行うことができたが、この変換のため、非常に離れたところに点が動いてしまい、巨大なポリゴンが発生してしまった。
  - 巨大なポリゴンをPMTilesに変更しようとした結果、PMTilesファイルのサイズが膨大になってしまい、Tippecanoeが終了しなくなった。
  - ogr2ogr で概ねのタイの領域をクリップすることでハンドルし、PMTilesファイルのサイズが莫大になることを防いだ。

## 3. なぜその差異が起こったのか？ (What went well? What could be improved?)
### うまく行った点
- Makefile を活用した一連の流れの自動化が成功し、効率的に PMTiles を生成できた。
- ogr2ogr と jq を組み合わせた前処理が効果的だった。
- Martin を使用した PMTiles のホスティングが簡単で、設定ファイルを利用することで柔軟性が向上した。
### 改善が必要な点
- Source Cooperative の不安定さにより、データの可用性が低下した。
  - ホスティング環境の冗長性が不足していた。
- H3 の課題
  - H3 ライブラリの使い勝手が悪く、期待した結果を得るのが難しかった。
  - H3 の使用を断念し、他のメッシュ体系を調査する必要がある。
  - 代替案として、GeoHex や他のオープンソースメッシュライブラリの検討を開始する。

## 4. 次にどうするか？ (What will we do differently next time?)
- Source Cooperative の代替または補完となるホスティングサービスを検討する。
- Martin のリバースプロキシ設定を見直し、冗長性を確保する。
- PMTiles の生成プロセスをさらに最適化し、エラー発生時のログを詳細化する。
- エラーの多いデータの場合には、早めにエラーデータを取り外す部分を加えるべきである。
